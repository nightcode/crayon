(function(){function e(e){function t(t){var r=n?e.filter(n):e;return r[t%r.length]}var n;return t.domain=function(n){return arguments.length?(e=n.map(Number),t):e},t.filter=function(e){return arguments.length?(n=e,t):n},t}function t(e){var t=e[0],n=e[e.length-1];return t<n?[t,n]:[n,t]}function n(e){return e.rangeExtent?e.rangeExtent():t(e.range())}crayon={version:"0.1"},crayon.colors=function(){return e(["#4fa55e","#c45c5b","#e7a847","#4b99eb","#a05eb5","#8983ef"])},crayon.legend=function(){function e(e){e.each(function(e){var f=d3.select(this);f.append("rect").style("stroke-width","1").attr("class","legend-container").attr("x","1").attr("y","0").attr("width",r-2).attr("height",i-2);var l=f.selectAll(".legend").data(e),c=l.enter().append("g").attr("class","legend-box").on("click",function(e,n){var r=d3.select(this).selectAll(".legend-rect");r.attr("class",e.disabled?"legend-rect":"legend-rect disabled"),t.onLegendClick(e,n)}),h=l.exit().remove(),p=l;c.append("rect").attr("class","legend-rect").attr("ry","3").attr("x","0").attr("y","0").attr("height","20");var d=c.append("g");d.append("path").style("stroke",function(e,t){return n(t)}).attr("class","legend-line").attr("d","m "+s.left+",10 "+o+",0"),d.append("text").text(function(e){return e.key}).attr("class","legend-text").attr("text-anchor","start").attr("dy","13").attr("dx",a);var v=[];d.selectAll(".legend-text").each(function(e){v.push(d3.select(this).node().getComputedTextLength())}),p.each(function(e,t){d3.select(this).select(".legend-rect").attr("width",v[t]+a+s.right)});var m=10;p.attr("transform",function(e,t){var n=m;return m+=v[t]+a+s.right+u,"translate("+n+",4)"})})}var t=d3.dispatch("onLegendClick"),n=crayon.colors(),r=400,i=30,s={top:0,right:5,bottom:0,left:5},o=7,u=8,a=s.left+s.left+o;return e.dispatch=t,e.colors=function(t){return arguments.length?(n=t,e):n},e.width=function(t){return arguments.length?(r=t,e):r},e.height=function(t){return arguments.length?(i=t,e):i},e},crayon.axis=function(){function e(e){e.each(function(){var e=d3.select(this),v=p==null?i.ticks?i.ticks.apply(i,h):i.domain():p,m=d==null?i.tickFormat?i.tickFormat.apply(i,h):String:d,g=e.selectAll("g").data(v,String),y=g.enter().insert("g","path").style("opacity",1e-6),b=d3.transition(g.exit()).style("opacity",1e-6).remove(),w=d3.transition(g).style("opacity",1),E,S=n(i),x=e.selectAll(".domain").data([0]),T=x.enter().append("path").attr("class","domain"),N=d3.transition(x),C=i.copy(),k=this.__chart__||C;this.__chart__=C,y.append("line").attr("class","tick"),y.append("text"),w.select("text").text(m),y.selectAll("line").filter(function(e){return!e}).classed("zero",!0),y.selectAll("text").filter(function(e){return!e}).classed("zero",!0);switch(s){case"horizontal":E=t,y.select("line").attr("y1",a),w.select("line").attr("x2",0).attr("y2",u),w.select("text").attr("x",0).attr("y",10+a).attr("dy",".71em").attr("text-anchor","middle"),N.attr("d","M"+S[0]+",0V0H"+S[1]+"V0");break;case"vertical":E=r,w.select("line").attr("x1",-c).attr("x2",-c+u).attr("y2",0),N.attr("d","M"+l+",0H"+l+"V"+S[1]+"H"+l);switch(o){case"start":w.select("text").attr("x",f).attr("y",0).attr("dy","-.32em").attr("text-anchor","start");break;case"end":w.select("text").attr("x",-f).attr("y",0).attr("dy","-.32em").attr("text-anchor","end")}}if(i.ticks)y.call(E,k),w.call(E,C),b.call(E,C);else{var L=C.rangeBand()/2,A=function(e){return C(e)+L};y.call(E,A),w.call(E,A)}})}function t(e,t){e.attr("transform",function(e){return"translate("+t(e)+","+c+")"})}function r(e,t){e.attr("transform",function(e){return"translate("+c+","+t(e)+")"})}var i=d3.scale.linear(),s="horizontal",o="end",u=6,a=0,f=3,l=0,c=0,h=[10],p=null,d;return e.scale=function(t){return arguments.length?(i=t,e):i},e.orient=function(t){return arguments.length?(s=t,e):s},e.textAnchor=function(t){return arguments.length?(o=t,e):o},e.ticks=function(){return arguments.length?(h=arguments,e):h},e.tickValues=function(t){return arguments.length?(p=t,e):p},e.tickFormat=function(t){return arguments.length?(d=t,e):d},e.tickSize=function(t,n){if(!arguments.length)return u;var r=arguments.length-1;return u=t,a=r>0?+n:u,e},e.tickPadding=function(t){return arguments.length?(f=+t,e):f},e.axisPosition=function(t){return arguments.length?(l=t,e):l},e.tickPosition=function(t){return arguments.length?(c=t,e):c},e},crayon.bar=function(){function e(e,s){var o=[],u=-1,a=e.length,f;while(++u<a)f=e[u],o.push("M",t(f,u,s),",",n(f,u,s),"V",r(f,u,s),"h",i(f,u,s),"V",n(f,u,s));return o.join("")}var t=function(e,t,n){return e.x},n=function(e,t,n){return 0},r=function(e,t,n){return e.y},i=function(e,t,n){return 7};return e.x=function(n){return arguments.length?(t=n,e):t},e.y=function(t){return arguments.length?(n=t,e):n},e.height=function(t){return arguments.length?(r=t,e):r},e.width=function(t){return arguments.length?(i=t,e):i},e},crayon_chart=function(){function e(u){u.each(function(){var a=this,l=d3.select(a),c=l.select("g"),h=c.select(".chart");s.colors(i).width(n);var p=o?s.height():1;f.colors(i).width(n-t.left-t.right).height(r-t.top-t.bottom-p);if(c.empty()){c=l.append("svg").attr("width",n).attr("height",r).append("g"),c.append("g").attr("class","chart").attr("transform","translate(0,0)"),c.select(".chart").append("rect").style("stroke-width","1").attr("class","chart-container").attr("x","1").attr("y","1").attr("width",n-2).attr("height",r-p-1),h=c.select(".chart"),h.append("g").attr("class","chart-box").attr("transform","translate("+t.left+","+t.top+")");if(o){var d=c.append("g").attr("class","legendPaint").attr("transform","translate(0, "+(r-p)+")");d.datum(f.seriesNames()).call(s),s.dispatch.on("onLegendClick",function(t){t.disabled=!t.disabled,u.transition().call(e)})}}h.select("g").call(f)})}var t={top:20,right:20,bottom:30,left:20},n=400,r=200,i=crayon.colors(),s=crayon.legend(),o=!0,u=function(e,t){return e[t]},a=function(e,t){return e[t]},f,l;return e.margin=function(n){return arguments.length?(t=n,e):t},e.width=function(t){return arguments.length?(n=t,e):n},e.height=function(t){return arguments.length?(r=t,e):r},e.x=function(t){return arguments.length?(u=t,e):u},e.y=function(t){return arguments.length?(a=t,e):a},e.xScale=function(t){return arguments.length?(f.xScale(t),e):f.xScale()},e.yScale=function(t){return arguments.length?(f.yScale(t),e):f.yScale()},e.xTickFormat=function(t){return arguments.length?(f.xTickFormat(t),e):f.xTickFormat()},e.colors=function(t){return arguments.length?(i.domain(t),e):i.domain()},e.legendVisible=function(t){return arguments.length?(o=t,e):o},e.data=function(t){if(!arguments.length)return l;l=t;var n=d3.keys(l[0]),r=n.filter(function(e,t){return t!==0}).map(function(e){return{key:e,disabled:!1}}).sort(),i=r.map(function(e){return l.map(function(t){return{x:u.call(l,t,n[0]),y:a.call(l,t,e.key)}})});return f.seriesNames(r),f.series(i),e},e.chart=function(t){return arguments.length?(f=t,e):f},e},crayon.barChart=function(){return crayon_chart().chart(crayon_barChart())},crayon_barChart=function(){function e(e){e.each(function(){var e=d3.select(this),h=e.select("g");if(h.empty()){h=e.append("g"),h.append("g").attr("class","x bar-axis").attr("transform","translate(0,"+n+")").append("path").attr("d","M0,0V0H"+t+"V0"),h.append("g").attr("class","y bar-axis").attr("transform","translate(0,0)"),h.append("g").attr("class","bars-chart"),l.filter(function(e,t){return f.length>t&&!f[t].disabled});var p=a[0].length,d=t/p<70?t:70*p;i.range([n,10]),o.ticks(d3.max([2,n/50])).tickSize(t).tickPosition(t),i.domain([0,d3.max(d3.merge(a),function(e){return e.y})]).nice(),h.select(".y.bar-axis").call(o);var v=[];h.select(".y.bar-axis").selectAll("text").each(function(e){v.push(d3.select(this).node().getComputedTextLength())});var m=d3.max(v);r.rangeRoundBands([0,d-m],.3).domain(d3.merge(a).map(function(e){return e.x})),s.tickFormat(c);var g=d3.scale.ordinal().domain(f.map(function(e){return e.key})).rangeRoundBands([0,r.rangeBand()]);u.x(function(e,t,n){return r(e.x)+n*g.rangeBand()}).y(function(){return n}).height(function(e){return i(e.y)}).width(function(){return g.rangeBand()})}var y=a.filter(function(e,t){return!f[t].disabled}),b=d3.merge(y);r.domain(b.map(function(e){return e.x})),i.domain([0,d3.max(b,function(e){return e.y})]).nice(),h.select(".x.bar-axis").call(s),h.select(".y.bar-axis").call(o);var w=h.select(".bars-chart").selectAll(".bar-chart").data(y.length>0?d3.layout.stack()(y):[]),E=w.enter().append("path").attr("class","bar-chart"),S=w.exit().remove(),x=w.style("fill",function(e,t){return l(t)}).attr("d",u)})}var t=400,n=200,r=d3.scale.ordinal(),i=d3.scale.linear(),s=crayon.axis().scale(r).orient("horizontal"),o=crayon.axis().scale(i).orient("vertical"),u=crayon.bar(),a,f,l,c=function(e){return e};return e.width=function(n){return arguments.length?(t=n,e):t},e.height=function(t){return arguments.length?(n=t,e):n},e.xScale=function(t){return arguments.length?(r=t,e):r},e.yScale=function(t){return arguments.length?(i=t,o.scale(i),e):i},e.xTickFormat=function(t){return arguments.length?(c=t,e):c},e.series=function(t){return arguments.length?(a=t,e):a},e.seriesNames=function(t){return arguments.length?(f=t,e):f},e.colors=function(t){return arguments.length?(l=t,e):l},e},crayon.lineChart=function(){return crayon_chart().chart(crayon_lineChart())},crayon_lineChart=function(){function e(e){e.each(function(){var e=d3.select(this),h=e.select("g");if(h.empty()){h=e.append("g"),h.append("g").attr("class","x line-axis").attr("transform","translate(0,"+n+")"),h.append("g").attr("class","y line-axis").attr("transform","translate(0,0)"),h.append("g").attr("class","lines-chart"),l.filter(function(e,t){return f.length>t&&!f[t].disabled}),i.range([n,10]),o.ticks(d3.max([2,n/50])),i.domain([0,d3.max(d3.merge(a),function(e){return e.y})]).nice(),h.select(".y.line-axis").call(o);var p=[];h.select(".y.line-axis").selectAll("text").each(function(e){p.push(d3.select(this).node().getComputedTextLength())});var d=d3.max(p);h.attr("transform","translate("+d+",0)"),r.range([0,t-d]),s.tickSize(c,0),o.tickSize(t-d)}var v=a.filter(function(e,t){return!f[t].disabled}),m=d3.merge(v);r.domain(d3.extent(m,function(e){return e.x})),i.domain([0,d3.max(m,function(e){return e.y})]).nice(),h.select(".x.line-axis").call(s),h.select(".y.line-axis").call(o);var g=h.select(".lines-chart").selectAll(".line-chart").data(v),y=g.enter().append("path").attr("class","line-chart"),b=g.exit().remove(),w=g.style("stroke",function(e,t){return l(t)}).attr("d",u)})}var t=400,n=200,r=d3.scale.linear(),i=d3.scale.linear(),s=crayon.axis().scale(r).orient("horizontal"),o=crayon.axis().scale(i).orient("vertical"),u=d3.svg.line().x(function(e){return r(e.x)}).y(function(e){return i(e.y)}),a,f,l,c=function(e,t){return t!=0?-n:0};return e.width=function(n){return arguments.length?(t=n,e):t},e.height=function(t){return arguments.length?(n=t,e):n},e.xScale=function(t){return arguments.length?(r=t,s.scale(r),e):r},e.yScale=function(t){return arguments.length?(i=t,o.scale(i),e):i},e.series=function(t){return arguments.length?(a=t,e):a},e.seriesNames=function(t){return arguments.length?(f=t,e):f},e.colors=function(t){return arguments.length?(l=t,e):l},e},crayon.sparklineChart=function(){return crayon_sparklineChart()},crayon_sparklineChart=function(){function e(e){e.each(function(){var e=d3.select(this),t=e.select("g");if(t.empty()){t=e.append("svg").attr("width",r).attr("height",i).append("g"),a.range([s,r-s]),f.range([i-s,s]);var n=t.append("g").attr("class","x sparkline-axis"),o=t.append("g").attr("class","y sparkline-axis");n.append("path").attr("d","M0,0V0H"+r+"V0").attr("transform","translate(0,"+(i-s)+")"),o.append("path").attr("d","M0,"+i+"H0V0,"+i+"H0").attr("transform","translate("+s+",0)")}a.domain(d3.extent(c,function(e){return e.x})),f.domain([0,d3.max(c,function(e){return e.y})]);var u=t.selectAll(".sparkline-chart").data([c]),h=u.enter().append("path").style("stroke","#d04d55").style("fill","none").attr("class","sparkline-chart").attr("d",l),p=u.exit().remove(),d=u.attr("class","sparkline-chart").attr("d",l)})}function t(e){return a(e.x)}function n(e){return f(e.y)}var r=200,i=50,s=5,o=function(e,t){return e[t]},u=function(e,t){return e[t]},a=d3.scale.linear(),f=d3.scale.linear(),l=d3.svg.line().x(t).y(n),c;return e.width=function(t){return arguments.length?(r=t,e):r},e.height=function(t){return arguments.length?(i=t,e):i},e.x=function(t){return arguments.length?(o=t,e):o},e.y=function(t){return arguments.length?(u=t,e):u},e.xScale=function(t){return arguments.length?(a=t,e):a},e.yScale=function(t){return arguments.length?(f=t,e):f},e.data=function(t){if(!arguments.length)return c;var n=d3.keys(t[0]);return c=t.map(function(e){return{x:o.call(t,e,n[0]),y:u.call(t,e,n[1])}}),e},e}})();